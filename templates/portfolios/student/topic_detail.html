{% extends 'base_student.html' %}
{% load static %}

{% block title %}{{ topic.title }} - Mi Portafolio - {{ block.super }}{% endblock %}

{% block page_title %}{% endblock %}

{% block extra_css %}
<style>
    :root {
        /* Esquema de colores del dashboard estudiantil */
        --primary-color: #005CFF;
        --secondary-color: #A142F5;
        --accent-color: #00CFFF;
        --success-color: #00E676;
        --warning-color: #FFB300;
        --danger-color: #FF5722;
        
        /* Gradientes din√°micos */
        --primary-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        --secondary-gradient: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);
        --success-gradient: linear-gradient(135deg, var(--success-color) 0%, #4CAF50 100%);
        --warning-gradient: linear-gradient(135deg, var(--warning-color) 0%, #FF9800 100%);
        --accent-gradient: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
        
        /* Sombras */
        --shadow-sm: 0 2px 8px rgba(0, 92, 255, 0.12);
        --shadow-md: 0 8px 24px rgba(0, 92, 255, 0.15);
        --shadow-lg: 0 16px 48px rgba(0, 92, 255, 0.2);
        
        /* Otros */
        --border-radius: 12px;
        --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Animaciones */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    @keyframes glow {
        0%, 100% { box-shadow: 0 0 20px rgba(0, 92, 255, 0.3); }
        50% { box-shadow: 0 0 40px rgba(161, 66, 245, 0.5); }
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(180deg); }
    }

    /* Content Container */
    .content-container {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Breadcrumb Navigation */
    .context-bar {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        font-size: 0.9rem;
        background: white;
        padding: 15px 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        border: 1px solid rgba(0, 92, 255, 0.1);
        animation: fadeInUp 0.6s ease-out;
    }

    .context-bar a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition-fast);
    }

    .context-bar a:hover {
        color: var(--secondary-color);
        text-decoration: underline;
    }

    .context-bar .separator {
        margin: 0 12px;
        color: var(--secondary-color);
        font-weight: 600;
    }

    .context-bar .current {
        color: #64748b;
        font-weight: 600;
    }

    /* Topic Header */
    .topic-header {
        background: var(--primary-gradient);
        border-radius: var(--border-radius);
        padding: 40px;
        color: white;
        margin-bottom: 30px;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
        animation: fadeInUp 0.8s ease-out 0.1s both;
    }

    .topic-header::before {
        content: '';
        position: absolute;
        top: -30%;
        right: -15%;
        width: 300px;
        height: 300px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 12s ease-in-out infinite;
    }

    .topic-header::after {
        content: '';
        position: absolute;
        bottom: -40%;
        left: -20%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 50%;
        animation: float 8s ease-in-out infinite reverse;
    }

    .header-content {
        position: relative;
        z-index: 2;
    }

    .topic-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 15px;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        background: linear-gradient(45deg, white, rgba(255, 255, 255, 0.8));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .topic-subtitle {
        font-size: 1.2rem;
        opacity: 0.95;
        margin-bottom: 25px;
        font-weight: 500;
    }

    .topic-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .meta-card {
        background: rgba(255, 255, 255, 0.15);
        border-radius: var(--border-radius);
        padding: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: var(--transition-normal);
    }

    .meta-card:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-5px);
    }

    .meta-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        display: block;
    }

    .meta-label {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-bottom: 5px;
    }

    .meta-value {
        font-size: 1.1rem;
        font-weight: 700;
    }

    /* Topic Info Section */
    .topic-info {
        background: white;
        border-radius: var(--border-radius);
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(0, 92, 255, 0.1);
        animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    .info-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .topic-description {
        line-height: 1.7;
        color: #64748b;
        font-size: 1rem;
        margin-bottom: 20px;
    }

    .alert-custom {
        border-radius: var(--border-radius);
        border: none;
        padding: 20px;
        margin: 20px 0;
    }

    .alert-info-custom {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        color: #1565c0;
        border-left: 4px solid var(--primary-color);
    }

    .alert-warning-custom {
        background: linear-gradient(135deg, #fff3e0 0%, #ffcc02 100%);
        color: #e65100;
        border-left: 4px solid var(--warning-color);
    }

    /* Materials Section */
    .materials-section {
        animation: fadeInUp 0.8s ease-out 0.3s both;
    }

    .section-header {
        background: white;
        border-radius: var(--border-radius);
        padding: 25px 30px;
        margin-bottom: 25px;
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(0, 92, 255, 0.1);
    }

    .section-title {
        font-size: 1.6rem;
        font-weight: 700;
        color: var(--primary-color);
        margin: 0;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .materials-count {
        background: var(--primary-gradient);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 700;
        animation: pulse 2s infinite;
    }

    .category-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-left: 10px;
    }

    .badge-class {
        background: rgba(0, 92, 255, 0.15);
        color: var(--primary-color);
        border: 2px solid rgba(0, 92, 255, 0.3);
    }

    .badge-ai {
        background: rgba(0, 230, 118, 0.15);
        color: var(--success-color);
        border: 2px solid rgba(0, 230, 118, 0.3);
    }

    /* Material Cards */
    .materials-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 25px;
    }

    .material-category {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(0, 92, 255, 0.1);
        overflow: hidden;
        transition: var(--transition-normal);
        min-height: 400px;
        display: flex;
        flex-direction: column;
    }

    .material-category:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-lg);
    }

    .material-category.class-materials {
        border-left: 4px solid var(--primary-color);
        position: relative;
    }

    .material-category.class-materials::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-gradient);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .material-category.ai-materials {
        border-left: 4px solid var(--success-color);
        position: relative;
    }

    .material-category.ai-materials::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--success-gradient);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .category-header {
        padding: 25px;
        position: relative;
        overflow: hidden;
    }

    .category-header.class-materials {
        background: var(--primary-gradient);
        color: white;
    }

    .category-header.ai-materials {
        background: var(--success-gradient);
        color: white;
    }

    .category-header::before {
        content: '';
        position: absolute;
        top: -20px;
        right: -20px;
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .category-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin: 0 0 8px 0;
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
        z-index: 2;
    }

    .category-description {
        font-size: 0.9rem;
        opacity: 0.9;
        margin: 0;
        position: relative;
        z-index: 2;
    }

    .category-count {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
        z-index: 2;
    }

    .materials-list {
        padding: 25px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .material-item {
        background: #f8faff;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 15px;
        border: 2px solid transparent;
        transition: var(--transition-normal);
        position: relative;
        overflow: hidden;
    }

    .material-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 92, 255, 0.05), transparent);
        transition: left 0.6s;
    }

    .material-item:hover {
        border-color: var(--primary-color);
        transform: translateY(-3px);
        box-shadow: var(--shadow-sm);
    }

    .material-item:hover::before {
        left: 100%;
    }

    .material-item.ai-material {
        background: #f0fff4;
        border-left: 4px solid var(--success-color);
    }

    .material-item.ai-material:hover {
        border-color: var(--success-color);
    }

    .material-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .material-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary-color);
        margin: 0 0 8px 0;
        line-height: 1.3;
        flex: 1;
    }

    .material-badge {
        background: var(--success-gradient);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 700;
        margin-left: 10px;
    }

    .material-type-badge {
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.7rem;
        font-weight: 700;
        margin-left: 10px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .material-type-badge.class-badge {
        background: rgba(0, 92, 255, 0.1);
        color: var(--primary-color);
        border: 1px solid rgba(0, 92, 255, 0.3);
    }

    .material-type-badge.ai-badge {
        background: rgba(0, 230, 118, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(0, 230, 118, 0.3);
    }

    .material-meta {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 0.85rem;
        color: #64748b;
        margin-bottom: 12px;
    }

    .material-meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .material-description {
        color: #64748b;
        font-size: 0.9rem;
        line-height: 1.5;
        margin-bottom: 15px;
    }

    .material-actions {
        display: flex;
        gap: 10px;
    }

    .btn-material {
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: var(--transition-normal);
        border: 2px solid transparent;
    }

    .btn-material-primary {
        background: var(--primary-gradient);
        color: white;
    }

    .btn-material-primary:hover {
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }

    .btn-material-success {
        background: var(--success-gradient);
        color: white;
    }

    .btn-material-success:hover {
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }

    .btn-material-secondary {
        background: rgba(100, 116, 139, 0.1);
        color: #64748b;
        border: 2px solid #64748b;
    }

    .btn-material-secondary:hover {
        background: #64748b;
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }

    .btn-material-warning {
        background: var(--warning-gradient);
        color: white;
    }

    .btn-material-warning:hover {
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
    
    /* SCORM Specific Styles */
    .scorm-material {
        position: relative;
        border-left: 4px solid #ff6b6b !important;
        background: linear-gradient(135deg, rgba(255, 107, 107, 0.05), rgba(78, 205, 196, 0.05));
    }
    
    .scorm-material::before {
        content: '‚ö°';
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 1.2rem;
        opacity: 0.7;
        color: #ff6b6b;
    }
    
    .btn-material-scorm {
        background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
        color: white;
        border: none;
        transition: all 0.3s ease;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .btn-material-scorm:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        color: white;
    }
    
    .scorm-info {
        background: rgba(255, 107, 107, 0.1);
        border: 1px solid rgba(255, 107, 107, 0.2);
        border-radius: 8px;
        padding: 8px 12px;
        margin-top: 8px;
        font-size: 0.85rem;
        color: #d63031;
    }

    /* Empty States */
    .empty-state {
        text-align: center;
        padding: 60px 30px;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .empty-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin-bottom: 20px;
        animation: pulse 2s infinite;
    }

    .empty-icon.class-icon {
        background: rgba(0, 92, 255, 0.1);
        color: var(--primary-color);
    }

    .empty-icon.ai-icon {
        background: rgba(0, 230, 118, 0.1);
        color: var(--success-color);
    }

    .empty-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 10px;
    }

    .empty-subtitle {
        color: #64748b;
        font-size: 0.95rem;
        line-height: 1.5;
        max-width: 300px;
    }

    /* Feedback Section */
    .feedback-section {
        background: white;
        border-radius: var(--border-radius);
        padding: 30px;
        margin-top: 30px;
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(0, 92, 255, 0.1);
        animation: fadeInUp 0.8s ease-out 0.4s both;
    }

    .feedback-content {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border-radius: var(--border-radius);
        padding: 25px;
        border-left: 4px solid var(--primary-color);
    }

    .feedback-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
    }

    .feedback-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary-gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.3rem;
    }

    .feedback-meta {
        flex: 1;
    }

    .feedback-date {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary-color);
        margin: 0;
    }

    .feedback-label {
        font-size: 0.9rem;
        color: #64748b;
        margin: 0;
    }

    .feedback-text {
        color: #1565c0;
        line-height: 1.6;
        margin: 0;
    }

    .grade-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px solid rgba(21, 101, 192, 0.2);
    }

    .grade-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 1rem;
    }

    .grade-excellent { background: var(--success-gradient); color: white; }
    .grade-good { background: var(--primary-gradient); color: white; }
    .grade-average { background: var(--warning-gradient); color: white; }
    .grade-poor { background: var(--danger-color); color: white; }

    /* Back Button */
    .back-button {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 12px 20px;
        border-radius: var(--border-radius);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        transition: var(--transition-normal);
        backdrop-filter: blur(10px);
    }

    .back-button:hover {
        background: rgba(255, 255, 255, 0.3);
        color: white;
        transform: translateY(-2px);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .content-container {
            padding: 15px;
        }

        .topic-header {
            padding: 25px 20px;
        }

        .topic-title {
            font-size: 2rem;
        }

        .topic-meta {
            grid-template-columns: 1fr;
        }

        .materials-grid {
            grid-template-columns: 1fr;
        }

        .category-header {
            padding: 20px;
        }

        .materials-list {
            padding: 20px;
        }

        .material-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .material-actions {
            flex-direction: column;
            width: 100%;
        }

        .btn-material {
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .topic-title {
            font-size: 1.6rem;
        }

        .context-bar {
            padding: 12px 15px;
            font-size: 0.8rem;
        }

        .materials-section .section-title {
            font-size: 1.3rem;
        }
    }

    /* Loading states */
    .loading {
        opacity: 0.6;
        pointer-events: none;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid var(--primary-color);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>
{% endblock %}

{% block content %}
<div class="content-container">
    <!-- Breadcrumb Navigation -->
    <div class="context-bar">
        <a href="{% url 'dashboard:student_courses' %}">
            <i class="fas fa-graduation-cap me-2"></i>Mis Cursos
        </a>
        <span class="separator">‚Ä∫</span>
        <a href="{% url 'portfolios:student_portfolio_detail_by_course' topic.portfolio.id topic.course.id %}">
            {{ topic.course.name }}
        </a>
        <span class="separator">‚Ä∫</span>
        <span class="current">{{ topic.title }}</span>
    </div>

    <!-- Topic Header -->
    <div class="topic-header">
        <div class="header-content">
            <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
                <div class="flex-grow-1">
                    <h1 class="topic-title">
                        <i class="fas fa-book-open me-3"></i>{{ topic.title }}
                    </h1>
                    <p class="topic-subtitle">
                        <i class="fas fa-graduation-cap me-2"></i>{{ topic.course.name }} - 
                        <i class="fas fa-user-graduate me-2 ms-3"></i>{{ topic.portfolio.student.user.get_full_name }}
                    </p>
                </div>
                <div>
                    <a href="{% url 'portfolios:student_portfolio_detail_by_course' topic.portfolio.id topic.course.id %}" 
                       class="back-button">
                        <i class="fas fa-arrow-left"></i>
                        Volver al Portafolio
                    </a>
                </div>
            </div>
            
            <div class="topic-meta">
                <div class="meta-card">
                    <i class="fas fa-code meta-icon"></i>
                    <div class="meta-label">C√≥digo del Curso</div>
                    <div class="meta-value">{{ topic.course.code }}</div>
                </div>
                <div class="meta-card">
                    <i class="fas fa-layer-group meta-icon"></i>
                    <div class="meta-label">Tema de Estudio</div>
                    <div class="meta-value">Material Disponible</div>
                </div>
                <div class="meta-card">
                    <i class="fas fa-calendar-alt meta-icon"></i>
                    <div class="meta-label">Fecha de Creaci√≥n</div>
                    <div class="meta-value">{{ topic.created_at|date:"d/m/Y" }}</div>
                </div>
                <div class="meta-card">
                    <i class="fas fa-folder-open meta-icon"></i>
                    <div class="meta-label">Total Materiales</div>
                    <div class="meta-value">{{ materials|length }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Topic Information -->
    <div class="topic-info">
        <h3 class="info-title">
            <i class="fas fa-info-circle"></i>
            Descripci√≥n del Tema
        </h3>
        {% if topic.description %}
            <div class="topic-description">{{ topic.description|linebreaks }}</div>
        {% else %}
            <p class="topic-description">No hay descripci√≥n disponible para este tema.</p>
        {% endif %}
        
        {% if topic.instructions %}
            <h4 class="info-title mt-4">
                <i class="fas fa-list-ol"></i>
                Instrucciones
            </h4>
            <div class="alert-custom alert-info-custom">
                <i class="fas fa-lightbulb me-2"></i>
                {{ topic.instructions|linebreaks }}
            </div>
        {% endif %}
        
        {% if topic.due_date %}
            <div class="alert-custom alert-warning-custom">
                <i class="fas fa-clock me-2"></i>
                <strong>Fecha l√≠mite:</strong> {{ topic.due_date|date:"d/m/Y" }}
            </div>
        {% endif %}
    </div>
    
    <!-- Materials Section -->
    <div class="materials-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-folder-open"></i>
                Materiales del Tema
                <span class="materials-count">{{ total_materials_count }}</span>
                {% if regular_materials_count > 0 %}
                <span class="category-badge badge-class">
                    <i class="fas fa-chalkboard-teacher"></i>{{ regular_materials_count }}
                </span>
                {% endif %}
                {% if ai_materials_count > 0 %}
                <span class="category-badge badge-ai">
                    <i class="fas fa-magic"></i>{{ ai_materials_count }}
                </span>
                {% endif %}
            </h2>
        </div>
        
        {% if materials %}
            <div class="materials-grid">
                <!-- Material de Clase -->
                <div class="material-category class-materials">
                    <div class="category-header class-materials">
                        <h3 class="category-title">
                            <i class="fas fa-chalkboard-teacher"></i>
                            Material de Clase
                        </h3>
                        <p class="category-description">
                            Material compartido por tu profesor para todo el grado y sal√≥n
                        </p>
                        <div class="category-count">{{ regular_materials_count }}</div>
                    </div>
                    <div class="materials-list">
                        {% for material in class_materials %}
                            <div class="material-item{% if material.is_scorm_package and material.scorm_package %} scorm-material{% endif %}" data-material-id="{{ material.id }}">
                                <div class="material-header">
                                    <h4 class="material-title">
                                        {{ material.title }}
                                        <span class="material-type-badge class-badge">
                                            <i class="fas fa-users"></i> Clase
                                        </span>
                                    </h4>
                                </div>
                                <div class="material-meta">
                                    <div class="material-meta-item">
                                        <i class="fas fa-calendar-alt"></i>
                                        {{ material.created_at|date:"d/m/Y H:i" }}
                                    </div>
                                    <div class="material-meta-item">
                                        <i class="fas fa-user-tie"></i>
                                        Material del Profesor
                                    </div>
                                    {% if material.is_scorm_package and material.scorm_package %}
                                    <div class="material-meta-item">
                                        <i class="fas fa-cube text-warning"></i>
                                        <span>SCORM Interactivo</span>
                                    </div>
                                    {% elif material.file %}
                                    <div class="material-meta-item">
                                        {% with file_ext=material.file.name|slice:"-4:" %}
                                            {% if ".pdf" in file_ext %}
                                                <i class="fas fa-file-pdf text-danger"></i>
                                                <span>PDF</span>
                                            {% elif ".doc" in file_ext or ".docx" in file_ext %}
                                                <i class="fas fa-file-word text-primary"></i>
                                                <span>Word</span>
                                            {% elif ".ppt" in file_ext or ".pptx" in file_ext %}
                                                <i class="fas fa-file-powerpoint text-warning"></i>
                                                <span>PowerPoint</span>
                                            {% elif ".jpg" in file_ext or ".png" in file_ext or ".jpeg" in file_ext %}
                                                <i class="fas fa-image text-success"></i>
                                                <span>Imagen</span>
                                            {% elif ".mp4" in file_ext or ".avi" in file_ext %}
                                                <i class="fas fa-video text-info"></i>
                                                <span>Video</span>
                                            {% else %}
                                                <i class="fas fa-file text-muted"></i>
                                                <span>Archivo</span>
                                            {% endif %}
                                        {% endwith %}
                                    </div>
                                    {% endif %}
                                </div>

                                                <div class="material-actions">
                    {% if material.is_scorm_package and material.scorm_package %}
                        <!-- Solo mostrar bot√≥n SCORM para materiales SCORM -->
                        <a href="{% url 'scorm_packager:student_scorm_execute' material.scorm_package.id %}" 
                           class="btn-material btn-material-scorm" target="_blank">
                            <i class="fas fa-play-circle"></i>
                            üöÄ Ejecutar SCORM
                        </a>
                    {% elif material.file %}
                        <!-- Mostrar botones normales solo para materiales NO-SCORM -->
                        <a href="{{ material.file.url }}" class="btn-material btn-material-primary" target="_blank">
                            <i class="fas fa-eye"></i>
                            Ver Archivo
                        </a>
                        <a href="{{ material.file.url }}" class="btn-material btn-material-secondary" download>
                            <i class="fas fa-download"></i>
                            Descargar
                        </a>
                    {% endif %}
                </div>
                            </div>
                        {% empty %}
                            <div class="empty-state">
                                <div class="empty-icon class-icon">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                                <h4 class="empty-title">No hay materiales de clase</h4>
                                <p class="empty-subtitle">
                                    Tu profesor a√∫n no ha compartido materiales para todo el grado y sal√≥n en este tema.
                                </p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Material Personalizado -->
                <div class="material-category ai-materials">
                    <div class="category-header ai-materials">
                        <h3 class="category-title">
                            <i class="fas fa-user-circle"></i>
                            Material Personalizado
                        </h3>
                        <p class="category-description">
                            Material asignado espec√≠ficamente para ti (incluye contenido generado con IA)
                        </p>
                        <div class="category-count">{{ ai_materials_count }}</div>
                    </div>
                    <div class="materials-list">
                        {% for material in ai_materials %}
                            <div class="material-item ai-material{% if material.is_scorm_package and material.scorm_package %} scorm-material{% endif %}" data-material-id="{{ material.id }}">
                                <div class="material-header">
                                    <h4 class="material-title">
                                        {{ material.title }}
                                        {% if material.ai_generated %}
                                            <span class="material-type-badge ai-badge">
                                                <i class="fas fa-magic"></i> IA Personal
                                            </span>
                                        {% else %}
                                            <span class="material-type-badge ai-badge">
                                                <i class="fas fa-user"></i> Personal
                                            </span>
                                        {% endif %}
                                    </h4>
                                </div>
                                <div class="material-meta">
                                    <div class="material-meta-item">
                                        <i class="fas fa-calendar-alt"></i>
                                        {{ material.created_at|date:"d/m/Y H:i" }}
                                    </div>
                                    <div class="material-meta-item">
                                        {% if material.ai_generated %}
                                            <i class="fas fa-robot"></i>
                                            Generado con IA
                                        {% else %}
                                            <i class="fas fa-user-tie"></i>
                                            Material del Profesor
                                        {% endif %}
                                    </div>
                                    {% if material.is_scorm_package and material.scorm_package %}
                                    <div class="material-meta-item">
                                        <i class="fas fa-cube text-warning"></i>
                                        <span>SCORM Interactivo</span>
                                    </div>
                                    {% elif material.file %}
                                    <div class="material-meta-item">
                                        {% with file_ext=material.file.name|slice:"-4:" %}
                                            {% if ".pdf" in file_ext %}
                                                <i class="fas fa-file-pdf text-danger"></i>
                                                <span>PDF</span>
                                            {% elif ".doc" in file_ext or ".docx" in file_ext %}
                                                <i class="fas fa-file-word text-primary"></i>
                                                <span>Word</span>
                                            {% elif ".ppt" in file_ext or ".pptx" in file_ext %}
                                                <i class="fas fa-file-powerpoint text-warning"></i>
                                                <span>PowerPoint</span>
                                            {% elif ".jpg" in file_ext or ".png" in file_ext or ".jpeg" in file_ext %}
                                                <i class="fas fa-image text-success"></i>
                                                <span>Imagen</span>
                                            {% elif ".mp4" in file_ext or ".avi" in file_ext %}
                                                <i class="fas fa-video text-info"></i>
                                                <span>Video</span>
                                            {% else %}
                                                <i class="fas fa-file text-muted"></i>
                                                <span>Archivo</span>
                                            {% endif %}
                                        {% endwith %}
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="material-actions">
                                    {% if material.is_scorm_package and material.scorm_package %}
                                        <!-- Solo mostrar bot√≥n SCORM para materiales SCORM -->
                                        <a href="{% url 'scorm_packager:student_scorm_execute' material.scorm_package.id %}" 
                                           class="btn-material btn-material-scorm" target="_blank">
                                            <i class="fas fa-play-circle"></i>
                                            üöÄ Ejecutar SCORM
                                        </a>
                                    {% elif material.file %}
                                        <!-- Mostrar botones normales solo para materiales NO-SCORM -->
                                        <a href="{{ material.file.url }}" class="btn-material btn-material-success" target="_blank">
                                            <i class="fas fa-eye"></i>
                                            Ver Archivo
                                        </a>
                                        <a href="{{ material.file.url }}" class="btn-material btn-material-secondary" download>
                                            <i class="fas fa-download"></i>
                                            Descargar
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        {% empty %}
                            <div class="empty-state">
                                <div class="empty-icon ai-icon">
                                    <i class="fas fa-magic"></i>
                                </div>
                                <h4 class="empty-title">No hay material individual</h4>
                                <p class="empty-subtitle">
                                    Tu profesor puede generar material personalizado con IA espec√≠ficamente para ti.
                                </p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        {% else %}
            <div class="material-category">
                <div class="empty-state">
                    <div class="empty-icon class-icon">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <h3 class="empty-title">No hay materiales disponibles</h3>
                    <p class="empty-subtitle">
                        A√∫n no hay materiales disponibles para este tema. Tu profesor puede compartir material de clase o generar contenido personalizado para ti.
                    </p>
                </div>
            </div>
        {% endif %}
    </div>
    
    <!-- Teacher Feedback Section -->
    {% if topic.feedback %}
    <div class="feedback-section">
        <h3 class="info-title">
            <i class="fas fa-comment-dots"></i>
            Retroalimentaci√≥n del Profesor
        </h3>
        <div class="feedback-content">
            <div class="feedback-header">
                <div class="feedback-icon">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="feedback-meta">
                    <h4 class="feedback-date">{{ topic.feedback.created_at|date:"d/m/Y H:i" }}</h4>
                    <p class="feedback-label">Comentario del profesor</p>
                </div>
            </div>
            <div class="feedback-text">
                {{ topic.feedback.comment|linebreaks }}
            </div>
            {% if topic.feedback.grade %}
                <div class="grade-section">
                    <strong>Calificaci√≥n:</strong>
                    <span class="grade-badge {% if topic.feedback.grade >= 17 %}grade-excellent{% elif topic.feedback.grade >= 14 %}grade-good{% elif topic.feedback.grade >= 11 %}grade-average{% else %}grade-poor{% endif %}">
                        <i class="fas fa-star"></i>
                        {{ topic.feedback.grade }}/20
                    </span>
                </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Modal para previsualizar archivos -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewModalLabel">
                    <i class="fas fa-eye me-2"></i>Vista Previa del Material
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0" id="previewContent">
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cerrar
                </button>
                <a href="#" class="btn btn-primary" id="downloadModalBtn">
                    <i class="fas fa-download me-2"></i>Descargar
                </a>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Funcionalidad de vista previa de materiales
    function setupMaterialPreview() {
        const viewButtons = document.querySelectorAll('.btn-material[href*="file"]');
        const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
        const previewContent = document.getElementById('previewContent');
        const downloadBtn = document.getElementById('downloadModalBtn');
        const modalTitle = document.getElementById('previewModalLabel');

        viewButtons.forEach(btn => {
            if (btn.querySelector('.fa-eye')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const fileUrl = this.getAttribute('href');
                    const fileName = fileUrl.split('/').pop();
                    const fileExt = fileName.split('.').pop().toLowerCase();
                    const materialTitle = this.closest('.material-item').querySelector('.material-title').textContent.trim();

                    // Actualizar t√≠tulo del modal
                    modalTitle.innerHTML = `<i class="fas fa-eye me-2"></i>${materialTitle}`;
                    
                    // Configurar bot√≥n de descarga
                    downloadBtn.href = fileUrl;
                    downloadBtn.setAttribute('download', fileName);

                    // Limpiar contenido previo
                    previewContent.innerHTML = '<div class="text-center p-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Cargando...</span></div></div>';

                    // Mostrar modal
                    previewModal.show();

                    // Cargar contenido seg√∫n tipo de archivo
                    setTimeout(() => {
                        if (['pdf'].includes(fileExt)) {
                            previewContent.innerHTML = `
                                <div class="ratio ratio-16x9">
                                    <iframe src="${fileUrl}" style="border: none; width: 100%; height: 80vh;" allowfullscreen></iframe>
                                </div>
                            `;
                        } else if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileExt)) {
                            previewContent.innerHTML = `
                                <div class="text-center p-3">
                                    <img src="${fileUrl}" class="img-fluid" style="max-height: 70vh;" alt="${materialTitle}">
                                </div>
                            `;
                        } else if (['mp4', 'avi', 'mov', 'webm'].includes(fileExt)) {
                            previewContent.innerHTML = `
                                <div class="text-center p-3">
                                    <video controls style="max-width: 100%; max-height: 70vh;">
                                        <source src="${fileUrl}" type="video/${fileExt}">
                                        Tu navegador no soporta el elemento de video.
                                    </video>
                                </div>
                            `;
                        } else if (['mp3', 'wav', 'ogg'].includes(fileExt)) {
                            previewContent.innerHTML = `
                                <div class="text-center p-5">
                                    <div class="mb-4">
                                        <i class="fas fa-music fa-4x text-primary mb-3"></i>
                                        <h4>${materialTitle}</h4>
                                    </div>
                                    <audio controls style="width: 100%; max-width: 500px;">
                                        <source src="${fileUrl}" type="audio/${fileExt}">
                                        Tu navegador no soporta el elemento de audio.
                                    </audio>
                                </div>
                            `;
                        } else {
                            previewContent.innerHTML = `
                                <div class="text-center p-5">
                                    <div class="mb-4">
                                        <i class="fas fa-file fa-4x text-muted mb-3"></i>
                                        <h4>Vista previa no disponible</h4>
                                        <p class="text-muted">Este tipo de archivo no se puede previsualizar en el navegador.</p>
                                        <p class="text-muted"><strong>Archivo:</strong> ${fileName}</p>
                                    </div>
                                    <a href="${fileUrl}" class="btn btn-primary" download>
                                        <i class="fas fa-download me-2"></i>Descargar archivo
                                    </a>
                                </div>
                            `;
                        }
                    }, 500);
                });
            }
        });
    }

    // Configurar vista previa de materiales
    setupMaterialPreview();

    // Animaciones de entrada escalonadas
    const materialItems = document.querySelectorAll('.material-item');
    materialItems.forEach((item, index) => {
        item.style.animationDelay = `${0.5 + (index * 0.1)}s`;
        item.style.animation = 'fadeInUp 0.6s ease-out forwards';
        item.style.opacity = '0';
    });

    // Efectos hover mejorados para materiales
    materialItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });

    // Feedback visual al hacer clic en botones de descarga
    const downloadBtns = document.querySelectorAll('.btn-material');
    downloadBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
            
            // Toast de feedback
            showToast('Iniciando descarga...', 'info');
        });
    });

    // Contador animado para materiales
    function animateCounter(element, finalValue) {
        let currentValue = 0;
        const increment = Math.ceil(finalValue / 20);
        
        const counter = setInterval(() => {
            currentValue += increment;
            if (currentValue >= finalValue) {
                currentValue = finalValue;
                clearInterval(counter);
            }
            element.textContent = currentValue;
        }, 100);
    }

    // Animar contadores de categor√≠as
    document.querySelectorAll('.category-count').forEach(counter => {
        const finalValue = parseInt(counter.textContent);
        if (!isNaN(finalValue) && finalValue > 0) {
            animateCounter(counter, finalValue);
        }
    });

    // Sistema de notificaciones toast
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        const colors = {
            info: 'var(--primary-gradient)',
            success: 'var(--success-gradient)',
            warning: 'var(--warning-gradient)',
            error: 'var(--danger-color)'
        };
        
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${colors[type] || colors.info};
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            max-width: 300px;
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.transform = 'translateX(0)';
        }, 100);
        
        setTimeout(() => {
            toast.style.transform = 'translateX(400px)';
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 300);
        }, 3000);
    }

    // Lazy loading de im√°genes si existen
    const images = document.querySelectorAll('img[data-src]');
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.classList.remove('lazy');
                imageObserver.unobserve(img);
            }
        });
    });

    images.forEach(img => imageObserver.observe(img));

    // Efectos de parallax suave para elementos flotantes del header
    window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const parallaxElements = document.querySelectorAll('.topic-header::before, .topic-header::after');
        
        parallaxElements.forEach((element, index) => {
            const speed = 0.3 + (index * 0.1);
            if (element.style) {
                element.style.transform = `translateY(${scrolled * speed}px)`;
            }
        });
    });
});
</script>
{% endblock %} 